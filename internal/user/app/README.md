# app 层

`app` 应用层(application)。 它也被称为 "用例"，

`Application`层属于`Use Case`（业务用例）。业务用例一般都是描述比较大方向的需求，接口相对稳定，特别是对外的接口一般不会频繁变更。添加业务用例可以通过新增Application Service或者新增接口实现功能的扩展。


其主要是"粘合"其他层，是很薄的一层，依赖 领域层，但不依赖具体实现。


## 作用
- 业务编排，偏业务流程，和 domain(偏业务规则) 不同
- 调 domain 层，如果业务非常简单，只是单纯的CURD，可以直接调 data 层
- DTO定义
- 封装CQRS，
    - 所有接口分为Command（输入）和Query（输出）两种，类似于计算机系统中的I/O节点，有输入输出
- 应用层连接用户接口层(user interface 或 controller)和领域层(domain)，它是很薄的一层，主要职能是协调领域层多个聚合完成服务的组合和编排。
- 定义业务相关的接口，防腐用；该接口的定义推荐业务语义化，不要简单的UpdateXXX，CreateXXX。
    - 如果业务非常简单，比如就是一个CURD，并没有聚合其他业务的数据，那么可以直接调 repository 接口的实现，就不用定义新的接口了
    - 如果业务复杂，除了调本项目内部 repository，还要调其他项目的提供的服务，比如走grpc协议。那么需要**定义个接口**，在实现的时候 `struct` 包含 repository + grpcClient
    - 如果需要定义的接口可共用，则可以抽象出来，单独定义在一个 `services.go` 文件中；如果简单，就定义在对应业务中
- 应用层之下是领域层，领域层是由多个业务职责单一的聚合构成，实现核心的领域逻辑。应用层负责协调领域层多个聚合的领域服务或领域对象，面向用例和业务流程完成服务的组合和编排。所以理论上应用层不应该实现领域模型的领域逻辑。这也是应用层为什么会很薄的原因。
- 应用层之上是用户接口层，在应用层完成领域层服务组合和编排后，应用服务被用户接口层Facade服务封装，完成接口和数据适配后，以粗粒度的服务通过API网关面向前端应用发布。

此外，应用层也是微服务之间服务调用的通道，微服务在应用层可以调用其他微服务的应用服务，完成微服务之间的服务组合和编排。

在应用层主要有应用服务、事件订阅和发布等相关代码逻辑。

其中，应用服务主要负责服务的组合、编排和转发，处理业务用例的执行顺序以及结果的拼装。在应用服务中还可以进行安全认证、权限校验、事务控制、领域事件发布或订阅等

参考：
- [DDD系列 第二弹 - 应用架构](https://mp.weixin.qq.com/s/bhfnyhlKfrPpSh9-6of9xw)